# 데이터 링크 계층 : 랜에서 데이터 전송하기
> OSI 모델의 2계층인 데이터 링크 계층
> 이더넷, CSMA/CD 방식, MAC 주소, 스위치, 충돌 도메인, 이더넷 표준 이해 목표

> 데이터 링크 계층(Data Link Layer) : 네트워크 기기 간에 데이터를 전송하고 물리주소를 결정한다.

1. 데이터 링크 게층의 역할과 이더넷
  > 이더넷(Ethernet) : 컴퓨터 네트워크 기술 중 하나로 전 세계의 사무실이나 가정에서 일반적으로 사용되는 랜에서 가장 많이 활용되는 기술 규격
  - 데이터 링크 계층은 랜에서 데이터를 주고받기 위해 필요하다.
  - 데이터 링크 계층은 네트워크 장비 간에 신호를 주고받는 규칙을 정하는 계층이다.
  - 그 규칙들 중 일반적으로 가장 많이 사용되는 규칙이 **이더넷이다.**
  - 허브의 특징
    - 허브는 약해지거나 파형이 뭉그러진 전기 신호를 복원시키고, 해당 전기 신호를 전달받은 포트를 제외한 나머지 포트에 전달한다.
  - 데이터의 내용을 못보게 하는 규칙이 있는데, 그 규칙에 따라 보내려는 데이터에 목적지 정보를 추가해서 보내고, 목적지 이외의 컴퓨터는 데이터를 받더라도 무시하게 되어 있다.
  - 허브는 들어온 데이터를 그대로 모든 포트에 보내기만 하는 특징을 가지고 있어서, 컴퓨터가 여러 대가 동시에 데이터를 보내면 데이터들이 서로 부딪힐 수 있다. 이것을 **충돌(Collision)** 이라고 한다.
  - 이더넷은 **여러 컴퓨터가 동시에 데이터를 전송해도 충돌이 일어나지 않는 구조**로 되어 있다.
  - 데이터가 동시에 케이블을 지나가면 충돌할 수 밖에 없기 때문에, 데이터를 보내는 시점을 늦추는 방법이 있다.
    - 이처럼, 이더넷에서 시점을 늦추는 방법을 **CSMA/CD**라고 한다.
    - **CSMA/CD** : Carrier Sense Multiple Access with Collision Detection, 반송파 감지 다중 접속 및 충돌 탐지의 약어
      - CS : 데이터를 보내려고 하는 컴퓨터가 케이블에 신호가 흐르고 있는지 아닌지를 확인한다는 규칙
      - MA : 케이블에 데이터가 흐르고 있지 않다면 데이터를 보내도 좋다는 규칙
      - CD : 충돌이 발생하고 있는지를 확인한다는 규칙
  - 지금은 효율이 좋지 않다는 이유로 CSMA/CD는 거의 사용하고 있지 않다.
  - 현재 : **스위치(switch)**라는 네트워크 장비를 사용하면 충돌이 일어나지 않는다.
  
2. MAC 주소의 구조
  > 랜 카드를 제조할 때 정해지는 물리적인 주소
  
  > MAC 주소 : 랜에 사용되는 네트워크 모델인 이더넷의 물리적인 주소로, 컴퓨터 네트워크에서 각각의 기기를 구분하기 위해 사용하는 주소
  
  - 랜 카드는 비트열(0, 1)을 전기 신호로 변환한다고 했는데, 이러한 랜 카드에는 **MAC 주소**라는 번호가 정해져 있다.
    - MAC 주소 : Media Access Control Address, 물리 주소의 약어
    - 제조할 때 새겨지기 때문에 **물리 주소** 라고 부르는데, **전 세계에서 유일한 번호**로 할당되어 있다.
    - 48비트 숫자로 구성되어 있다. 앞 24비트는 랜 카드를 만든 제조사 번호고, 뒤쪽 24비트는 제조사가 랜 카드에 붙인 일련번호이다.
      - ex) : 00-23-AE-D9-7A-9A

  - MAC 주소를 사용한 통신
    - 각 계층에서 헤더를 붙이는 것을 배웠다. OSI 모델에서는 데이터 링크 계층에 해당하고, TCP/IP 모델에서는 네트워크 계층에 해당한다.
    - 이 계층에서 **이더넷 헤더**와 **트레일러** 를 붙인다.
      - 이더넷 헤더 : 목적지 MAC 주소(6바이트), 출발지 MAC 주소(6바이트), 유형(2바이트)로 총 14바이트로 구성되어 있다.
        - 이더넷 유형(Ethernet type) : 이더넷으로 전송되는 상위 계층 프로토콜의 종류로, 해당 프로토콜을 식별하는 16진수 번호가 들어간다.

        | 유형 번호 | 프로토콜 |
        |:----:|:----:|
        | 0800 | IPv4 |
        | 0806 | ARP |
        | 8035 | RARP |
        | 814C | SNMP over Ethernet |
        | 86DD | IPv6 |
        
        - 데이터 링크 계층에서 데이터 뒤에 추가하는 것을 트레일러라고 한다.
        - 트레일러를 FCS(Frame Check Sequence)라고도 하는데, 데이터 전송 도중에 오류가 발생하는지 확인하는 용도로 사용한다.
    - 이더넷 헤더와 트레일러가 추가된 데이터를 **프레임**이라고 한다. 네트워크를 통해 프레임이 전송된다.
    - 통신 예시
      - 컴퓨터 1, 2, 3, 4, 5 존재, 1개의 허브 존재, 1개의 허브로 모두 연결되어 있다.
        - 컴퓨터 1의 MAC 주소 : AA-AA-AA-AA-AA-AA
        - 컴퓨터 2의 MAC 주소 : BB-BB-BB-BB-BB-BB
        - 컴퓨터 3의 MAC 주소 : CC-CC-CC-CC-CC-CC
        - 컴퓨터 4의 MAC 주소 : DD-DD-DD-DD-DD-DD
        - 컴퓨터 5의 MAC 주소 : EE-EE-EE-EE-EE-EE
      - 컴퓨터 1 -> 컴퓨터 3 ; 데이터 전송 => 프레임 비트열 생성 - 목적지 MAC 주소(CC-CC-CC-CC-CC-CC) | 출발지 MAC 주소(AA-AA-AA-AA-AA-AA) | 유형 | 데이터 | 트레일러  -> 전송
        - 목적지 MAC 주소, 출발지 MAC 주소, 유형 이 세 가지를 이더넷 헤더라고 한다.
        - 보내는 측의 컴퓨터 1에서 캡슐화가 일어나고, 캡슐화가 일어난 후, 물리 계층에서 프레임 비트열을 전기 신호로 변환하여 네트워크를 통해 전송한다.
        - 컴퓨터 1에서 보낸 데이터를 허브로 전송하면, 허브와 연결된 모든 포트로 전송한다. 그러면 데이터는 다른 컴퓨터 2 ~ 5로 전송되지만, 목적지 MAC 주소가 자신의 MAC 주소와 다르기 때문에 **데이터를 파기**한다. 
        - 반대로, 컴퓨터 3은 자신의 MAC 주소가 컴퓨터 1이 보낸 데이터의 목적지 MAC 주소와 같으므로 데이터를 수신한다.
        - 즉, 캡슐화가 일어났지만, 역캡슐화도 이루어지는 것이다.
      - 만약, 컴퓨터 1과 컴퓨터 2가 동시에 컴퓨터 3에 데이터를 전송하게 되는 경우, 충돌을 방지하기 위해 CSMA/CD 방식이 사용된다.
        - 여기서 충돌이 감지되면 컴퓨터 2는 잠시 대기하고, 데이터를 다시 전송한다.
  

3. 스위치의 구조
  > 스위치는 허브와 달리 데이터 충돌이 발생하지 않는다.

  > 스위치 : 랜을 구성할 때 사용하는 단말기 간 스위칙 기능이 있는 통신망 중계 장치로, 컴퓨터(호스트)에서 특정한 다른 단말기로 패킷을 보낼 수 있는 기능이 있어 통신 효율이 향상된다.
  - 스위치(Switch) : **데이터 링크 계층**에서 동작하고 **레이어 2 스위치** 또는 **스위칭 허브**라고 불린다. 장비 외형은 허브와 비슷하다. 하지만 기능은 서로 다르다.
  - 스위치 내부에는 **MAC 주소 테이블(MAC Address Table)**이라는 것이 있다. MAC 주소 테이블은 스위치의 **포트 번호**와 해당 포트에 연결되어 있는 컴퓨터의 **MAC 주소**가 등록되는 데이터베이스이다.
    - MAC 주소 테이블을 **브리지 테이블(Bridge Table)**이라고도 한다.

  - 스위치의 전원을 켠 상태에서는 아직 MAC 주소 테이블에 아무것도 등록되어 있지 않다. 하지만 컴퓨터에서 목적지 MAC 주소가 추가된 **프레임**이라는 데이터가 전송되면 MAC 주소 테이블을 확인하고, 출발지 MAC 주소가 등록되어 있지 않으면 MAC 주소를 포트와 함께 등록한다. 이를 **MAC 주소 학습 기능**이라고 한다.

  - MAC 주소 학습 기능 : 데이터 전송 -> 스위치 -> MAC 주소 테이블 -> MAC 주소 테이블에 MAC 주소와 포트가 등록된다.
  - 컴퓨터 1에서 컴퓨터 3에 데이터를 전송한 시점에서는 아직 컴퓨터 3의 목적지 MAC 주소가 MAC 주소 테이블에 등록되어 있지 않아서 송신 포트 이외의 포트에 데이터 프레임이 전송된다. 이러한 데이터(프레임) 전송을 **플러딩(flooding, 홍수)**라고 부른다.
    - 플러딩 : 스위치가 수신 포트 이외의 모든 포트에서 데이터를 송신하는 것
  - MAC 주소 테이블에 목적지 MAC 주소가 등록되어 있다면, 목적지 MAC 주소가 등록된 컴퓨터에만 데이터가 전송된다. 
  - MAC 주소를 기준으로 목적지를 선택하는 것을 **MAC 주소 필터링**이라고 한다. 이것으로 불필요한ㄷ ㅔ이터를 네트워크에 전송하지 않게 되는 것이다.
  
4. 데이터가 케이블에서 충돌하지 않는 구조
  > 케이블에 데이터가 아무리 많이 전송되어도 데이터가 충돌하지 않는 구조에 대해 설명한다.
  
  - 통신 방식 : **전이중 통신 방식**, **반이중 통신 방식**
    - 전이중 통신 방식 : 데이터의 송수신을 **동시에** 통신하는 방식, 컴퓨터 간을 직접 랜 케이블로 연결하는 방식이다.
      - 전이중 통신 방식은 데이터를 동시에 전송해도 충돌이 발생하지 않는다. 
      - 스위치는 전송하면서 동시에 수신도 가능해서 효율이 매우 높다.

    - 반이중 통신 방식 : 회선 하나로 송신과 수신을 **번갈아가면서** 통신하는 방식, 허브에 연결하는 경우에 해당되는 방식이다.
      - 데이터를 동시에 전송하면 충돌이 발생한다.
      - 허브를 사용하면 회선 하나를 송신과 수신이 번갈아가면서 사용된다.
      - 허브 내부에는 송수신이 나누어져 있지 않기 때문에 충돌이 발생한다.
      
    - 스위치는 충돌이 일어나지 않는 구조로 되어 있기 때문에 **전이중 통신 방식**으로도 데이터를 주고받을 수 있다.
      - 허브를 사용하면 충돌이 생기면서 네트워크 지연이 발생하기 때문에 최근에는 네트워크로 스위치를 사용하는 것이 표준이다.
    
  - 충돌 도메인
    - **충돌 도메인(Collision Domain)** : 충돌이 발생할 때 그 영향이 미치는 범위
    - 허브는 모든 컴퓨터에 충돌의 영향이 미친다.
    - 허브에서 충돌이 발생하면, 허브에 연결되어 있는 컴퓨터 전체가 하나의 충돌 도메인이 된다. 
    - 스위치는 데이터를 동시에 송수신할 수 있는 전이중 통신 방식이기 떄문에 충돌이 일어나지 않고 충돌 도메인의 범위도 좁아진다. 즉, 접속되어 있는 모든 컴퓨터에 영향을 미치지 않는다.
    - 이런 충돌 도메인의 관점에서 보더라도 스위치를 사용하면 통신 효율이 높아진다는 것을 알 수 있다. 
      - 충돌 도메인의 범위가 넓을수록 네트워크가 지연되는 것으로, 네트워크를 지연시키지 않기 위해서라도 충돌 도메인의 범위를 좁하는 것이 매우 중요하다.

  - ARP(Address Resolution Protocol) : 주소 변호나 프로토콜
    - 네트워크 계층 주소와 데이터 링크 계층 주소 사이의 변환을 담당하는 프로토콜이다.
    - 목적지 컴퓨터의 IP 주소를 이용하여 MAC 주소를 찾기 위한 프로토콜이다.
    - IP 주소를 물리 주소인 MAC 주소로 변환하는 데 사용한다.
  - ARP 캐시(ARP cache) : 가장 최근에 변환한 'IP 대 하드웨어 주소'를 보관하고 있는 램(RAM)의 한 영역이다.
  - ARP 요청(ARP Request) : IP 주소를 대치할 수 있는 물리 주소인 MAC 주소를 찾아내기 위해 보내는 브로트캐스트 패킷 요청이다.
  - ARP 응답(ARP reply) : ARP 요청(Request)에 대한 응답으로 요청한 IP주소에 대한 물리 주소인 MAC 주소가 실려 있다.
  
5. 이더넷의 종류와 특징
  - 이더넷은, 케이블의 종류나 통신 속도에 따라 **다양한 규격**으로 분류된다. 이것을 **이더넷 규격**이라고 한다.
    | 규격 이름 | 통신 속도 | 케이블 | 케이블 최대 길이 | 표준화 연도 |
    |:----:|:----:|:---:|:---:|:---:|
    | 10BASE5 | 10Mbps | 동축케이블 | 500m | 1982년 |
    | 10BASE2 | 10Mbps | 동축케이블 | 185m | 1988년 |
    | 10BASE-T | 10Mbps | UTP케이블(Cat3이상)| 100m | 1990년 |
    | 100BASE-TX | 100Mbps | UTP케이블(Cat5이상) | 100m | 1995년 |
    | 1000BASE-T | 1000Mbps | UTP케이블(Cat5이상) | 100m | 1999년 |
    | 10GBASE-T | 10Gbps| UTP케이블(Cat6a이상) | 100m | 2006년 |
    
  - 이더넷 규격 이름의 뜻 : 10BASE-T => 10(통신 속도) | BASE(전송 방식) | T (케이블)
    - 통신 속도의 단위는 Mbps 단위이다.
    - BASE : BASEBAND라는 전송 방식을 나타낸다.
      - BASEBAND : 펄스 신호에 의한 디지털 전송 방식
    - T : 케이블 종류를 나타낸다.
    - 하이픈(-) 뒤에는 케이블 길이나 케이블 종류를 나타낸다.
      - 동축 케이블 : 케이블의 최대 길이를 100미터 단위로 표시한다.
        - ex) 10BASE5 : 케이블의 최대 길이가 500미터 -> 5로 표시됨
      - UTP케이블 : 케이블 종류를 나타냄
        - ex) 10BASE-T : UTP 케이블을 말하는 것.
---
# 네트워크 계층 : 목적지에 데이터 전달하기
> OSI 모델의 3계층인 네트워크 계층
> IP, 라우터, IP 주소, 서브넷, 라우팅을 이해하는 것이 목표.

- 용어 정리

  - IP 주소 클래스(IP Address Class) : IPv4에서 사용하는 주소 그룹에는 다섯 개가 있다.
    - A, B, C 클래스는 네트워크 ID와 호스트 ID로 구성된다.
    - D 클래스는 멀티캐스트 주소로 사용한다.
    - E 클래스는 필요에 따라 사용하기 위해 확보해 놓은 것이다.
  - 라우터(router) : 서로 다른 네트워크를 연결해 주는 장치로 현재의 네트워크에서 다른 네트어크로 패킷을 전송할 수 있도록 한다.
  - 라우팅(routing) : 네트워크에서 패킷을 목적지로 보낼 때 목적지까지 갈 수 있는 여러 가지 경로 중 한 가지 경로를 설정해 주는 과정이다.
  - 라우팅 테이블(routing table) : 컴퓨터 네트워크에서 목적지 주소를 목적지에 도달하기 위한 네트워크 노선으로 변환시킬 목적으로 사용된다. 다른 네트워크로 가기 위한 가장 좋은 라우터의 정보를 가지고 있다.
  - 서브넷(subnet) : 큰 네트워크를 분할해서 만든 작은 네트워크이다.
  - 서브넷팅(subneting) : 네트워크를 분할하기 위해 IP 주소의 구성을 변경하는 작업이다.
  - 서브넷 ID : IP 주소의 네트워크 부분을 늘리기 위해 서브넷 마스크로 사용되는 비트로 서브넷 비트(subnet bits)라고 한다.
  - 서브넷 마스크(subnet mask) : IP 주소의 네트워크 부분만 나타나게 하여 같은 네트워크인지를 판별하게 하는 마스크이다.
  - 멀티캐스트(multicast) : 한 컴퓨터(호스트)에서 패킷을 여러 컴퓨터로 동시에 전송하는 것을 말한다.
  - 브로드캐스트(broadcast) : IP 네트워크에 있는 모든 컴퓨터(호스트)로 데이터를 전송하는 방식
 
1. 네트워크 계층의 역할
  - 네트워크 계층(Network layer) : 다른 네트워크와 통신하기 위한 경로 설정을 위해 라우터를 통한 라우팅을 하며며 패킷 전송을 담당한다.
    - 서로 다른 네트워크에 있는 목적지로 데이터를 전송하기 위해 필요하다.
  - 데이터 링크 계층에선 이더넷 규칙을 기반으로 데이터 전송을 담당하고, 이 규칙에 따라 같은 네트워크에 있는 컴퓨터로는 데이터를 전송할 수 있지만, 인터넷이나 다른 네트워크로는 데이터를 전송할 수 없다. 
    - 즉, 수많은 네트워크가 연결된 환경에서 데이터 링크 계층의 기능만으로는 다른 네트워크로 데이터를 전송하기 힘들다.
  - 네트워크 계층을 통해 다른 네트워크로 데이터를 전송하려면 **라우터(router)**라는 네트워크 장비가 필요하다.
    - 라우터(router) : 데이터의 목적지가 정해지면 **해당 목적지까지 어떤 경로로 가는 것이 좋은지**를 알려주는 기능을 한다. 
      - 하지만 데이터를 보내려는 상대가 어디에 있는지 모르면 라우터도 목적지까지의 경로를 알려주지 못한다.
    
    - 랜에서는 MAC 주소만으로도 통신할 수 있지만, 다른 네트워크에서는 데이터를 보낼 수가 없다. 그래서 MAC 주소가 아닌 네트워크를 식별할 수 있는 주소가 필요한데, 그러한 주소가 **IP 주소이다.**
    - IP 주소(IP Address) : 컴퓨터 네트워크에서 장치들이 서로를 인식하고 통신하기 위해 사용하는 주소
      - IP 주소는 어떤 네트워크의 어던 컴퓨터인지를 구분할 수 있도록 하는 주소이다.

  - 그런데, IP 주소로 목적지를 지정하는 것뿐만 아니라 데이터를 **어떤 경로**로 보낼지도 결정을 해야 한다.
    - 이처럼, 목적지 IP 주소까지 어떤 경로로 데이터를 보낼 지 결정하는 것을 **라우팅(Routing)**이라고 한다.
  - 라우팅은 라우터 장비가 하는데, **레이어 3 스위치**라는 장비도 라우팅을 할 수 있다.
  - 라우터를 사용하여 거리에 관계없이 다른 네트워크로 데이터를 보낼 수 있다.
  - 라우터에는 라우팅 테이블이 잇어서 경로 정보를 등록하고 관리한다.

  - 네트워크 계층에는 IP(Internet Protocol)이라는 프로토콜이 있다.
    - IP(Internet Protocol, 인터넷 프로토콜) : 인터넷에 있는 한 컴퓨터에서 다른 컴퓨터로 데이터를 보내는 데 사용되는 네트워크 계층 프로토콜이다.
  - 네트워크 계층에서는 캡슐화할 때 **IP 헤더**를 붙인다.
    - IP 헤더에는 데이터를 정확하게 전달하기 위해 필요한 정보가 포함되어 있다.
    - 버전, 헤더 길이, 서비스 유형, 전체 패킷 길이, ID, 조각 상태, 조각의 위치, TTL, 프로토콜, 헤더 체크섬, 출발지 IP 주소, 목적지 IP 주소 순서로 헤더 정보가 구성되어 있다.
  
  - IP 프로토콜을 사용하여 캡슐화할 때는 데이터에 IP 헤더가 추가되는데, 이렇게 만들어진 것을 **IP 패킷**이라고 한다.
  
2. IP 주소의 구조
  > 네트워크 간의 통신을 하려면 IP 주소가 필요하다.

  - IP 주소는 **인터넷 서비스 제공자(ISP)**에게 받을 수 있다.
  - IP 버전 : IPv4, IPv6
    - IPv4 
      - 현재 주로 사용하고 있는 IP 주소
      - 32비트로 되어 있다.
    - IPv6
      - 인터넷이 널리 보급되면서 IP주소가 부족해져서 만들어진 IP 주소
      - 128비트로 되어 있어서 IPv4보다 많은 IP 주소를 만들 수 있다.

  - IP 주소에는 **공인 IP 주소**와 **사설 IP 주소**가 있다.
    - 공인 IP 주소는 인터넷 서비스 제공자(ISP)가 제공한다.

  - IP 주소가 두 종류가 필요한 이유는, 사용할 수 있는 주소의 수가 고갈되고 있기 때문이다.
    - 그래서 인터넷에 직접 연결되는 컴퓨터나 라우터에는 **공인 IP 주소**를 할당하고, 회사나 가정의 랜에 있는 컴퓨터는 **사설 IP 주소** 를 할당하는 정책을 사용하고 있다.

  - 랜 안에 컴퓨터가 여러 대 있다면, 공인 IP주소는 사용할 수 있는 숫자가 제한되므로, 컴퓨터 한 대당 공인 IP 주소를 하나씩 할당하기 힘드므로, 우선 인터넷 서비스 공급자가 제공하는 공인 IP주소는 라우터에만 할당하고, 랜 안에 있는 컴퓨터에는 랜의 네트워크 관리자가 자유롭게 사설 IP 주소를 할당하거나 라우터의 **DHCP**기능을 사용하여 주소를 자동으로 할당하고 있다.
    - DHCP : Dynamic Host Configuration Protocol, IP 주소를 자동으로 할당하는 프로토콜

  - MAC 주소는 48비트로 구분하기 쉽도록 16진수로 표시하는데, IP주소는 32비트로 구분하기 쉽도록 10진수로 표시한다.
  - 컴퓨터가 이해할 수 있으려면 2진수가 필요하지만, 사람도 읽기 쉬워야 하므로 8비트 단위로 나눠서 표시한다.
  - 그리고 조금 더 읽기 쉽도록 8비트 10진수로 변환한다.
  
  - IP 주소는 10진수로 표시하지만, 실제로 IP 주소는 2진수로 되어 있다는 것을 기억하자.
  - 그리고 실제 IP 주소가 2진수로 되어 있고, 사람이 읽기 쉽게 하기 위해 8비트 단위로 나눠서 표시하기 때문에, 10진수의 범위가 정해져 있다. (0 ~ 255)

  - IP 주소는 네트워크 ID와 호스트 ID로 나눠져 있다.
    - 참고 : 여기서 말하는 네트워크 ID는 네트워크 주소라고 번역하는 경우가 있지만, 구별하기 위해 네트워크 ID라고 기록한다.(원본 : 일어)
    - 호스트 ID도 호스트 주소라고 번역하는 경우가 있지만, 호스트 ID라고 한다.

  - 네트워크 ID는 '어떤 네트워크'인지 나타낸다.
  - 호스트 ID는 '해당 네트워크의 어느 컴퓨터'인지 나타낸다.
  - 이 두 가지 정보가 합쳐져서 IP 주소가 되는 것이다.
  
3. IP 주소의 클래스 구조

4. 네트워크 주소와 브로드캐스트 주소의 구조

5. 서브넷의 구조

6. 라우터의 구조


-----
# 전송 계층 : 신뢰할 수 있는 데이터 전송하기
1. 전송 계층의 역할
2. TCP의 구조
3. 일련번호와 확인 응답 번호의 구조
4. 포트 번화의 구조
5. UDP의 구조
