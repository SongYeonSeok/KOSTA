# 데이터 링크 계층 : 랜에서 데이터 전송하기
> OSI 모델의 2계층인 데이터 링크 계층
> 이더넷, CSMA/CD 방식, MAC 주소, 스위치, 충돌 도메인, 이더넷 표준 이해 목표

1. 데이터 링크 게층의 역할과 이더넷
  - 데이터 링크 계층은 랜에서 데이터를 주고받기 위해 필요하다.
  - 데이터 링크 계층은 네트워크 장비 간에 신호를 주고받는 규칙을 정하는 계층이다.
  - 그 규칙들 중 일반적으로 가장 많이 사용되는 규칙이 **이더넷이다.**
  - 허브의 특징
    - 허브는 약해지거나 파형이 뭉그러진 전기 신호를 복원시키고, 해당 전기 신호를 전달받은 포트를 제외한 나머지 포트에 전달한다.
  - 데이터의 내용을 못보게 하는 규칙이 있는데, 그 규칙에 따라 보내려는 데이터에 목적지 정보를 추가해서 보내고, 목적지 이외의 컴퓨터는 데이터를 받더라도 무시하게 되어 있다.
  - 허브는 들어온 데이터를 그대로 모든 포트에 보내기만 하는 특징을 가지고 있어서, 컴퓨터가 여러 대가 동시에 데이터를 보내면 데이터들이 서로 부딪힐 수 있다. 이것을 **충돌(Collision)** 이라고 한다.
  - 이더넷은 **여러 컴퓨터가 동시에 데이터를 전송해도 충돌이 일어나지 않는 구조**로 되어 있다.
  - 데이터가 동시에 케이블을 지나가면 충돌할 수 밖에 없기 때문에, 데이터를 보내는 시점을 늦추는 방법이 있다.
    - 이처럼, 이더넷에서 시점을 늦추는 방법을 **CSMA/CD**라고 한다.
    - **CSMA/CD** : Carrier Sense Multiple Access with Collision Detection, 반송파 감지 다중 접속 및 충돌 탐지의 약어
      - CS : 데이터를 보내려고 하는 컴퓨터가 케이블에 신호가 흐르고 있는지 아닌지를 확인한다는 규칙
      - MA : 케이블에 데이터가 흐르고 있지 않다면 데이터를 보내도 좋다는 규칙
      - CD : 충돌이 발생하고 있는지를 확인한다는 규칙
  - 지금은 효율이 좋지 않다는 이유로 CSMA/CD는 거의 사용하고 있지 않다.
  - 현재 : **스위치(switch)**라는 네트워크 장비를 사용하면 충돌이 일어나지 않는다.
  
2. MAC 주소의 구조
  > 랜 카드를 제조할 때 정해지는 물리적인 주소
  
  - 랜 카드는 비트열(0, 1)을 전기 신호로 변환한다고 했는데, 이러한 랜 카드에는 **MAC 주소**라는 번호가 정해져 있다.
    - MAC 주소 : Media Access Control Address, 물리 주소의 약어
    - 제조할 때 새겨지기 때문에 **물리 주소** 라고 부르는데, **전 세계에서 유일한 번호**로 할당되어 있다.
    - 48비트 숫자로 구성되어 있다. 앞 24비트는 랜 카드를 만든 제조사 번호고, 뒤쪽 24비트는 제조사가 랜 카드에 붙인 일련번호이다.
      - ex) : 00-23-AE-D9-7A-9A

  - MAC 주소를 사용한 통신
    - 각 계층에서 헤더를 붙이는 것을 배웠다. OSI 모델에서는 데이터 링크 계층에 해당하고, TCP/IP 모델에서는 네트워크 계층에 해당한다.
    - 이 계층에서 **이더넷 헤더**와 **트레일러** 를 붙인다.
      - 이더넷 헤더 : 목적지 MAC 주소(6바이트), 출발지 MAC 주소(6바이트), 유형(2바이트)로 총 14바이트로 구성되어 있다.
        - 이더넷 유형(Ethernet type) : 이더넷으로 전송되는 상위 계층 프로토콜의 종류로, 해당 프로토콜을 식별하는 16진수 번호가 들어간다.

        | 유형 번호 | 프로토콜 |
        |:----:|:----:|
        | 0800 | IPv4 |
        | 0806 | ARP |
        | 8035 | RARP |
        | 814C | SNMP over Ethernet |
        | 86DD | IPv6 |
        
        - 데이터 링크 계층에서 데이터 뒤에 추가하는 것을 트레일러라고 한다.
        - 트레일러를 FCS(Frame Check Sequence)라고도 하는데, 데이터 전송 도중에 오류가 발생하는지 확인하는 용도로 사용한다.
    - 이더넷 헤더와 트레일러가 추가된 데이터를 **프레임**이라고 한다. 네트워크를 통해 프레임이 전송된다.
    - 통신 예시
      - 컴퓨터 1, 2, 3, 4, 5 존재, 1개의 허브 존재, 1개의 허브로 모두 연결되어 있다.
        - 컴퓨터 1의 MAC 주소 : AA-AA-AA-AA-AA-AA
        - 컴퓨터 2의 MAC 주소 : BB-BB-BB-BB-BB-BB
        - 컴퓨터 3의 MAC 주소 : CC-CC-CC-CC-CC-CC
        - 컴퓨터 4의 MAC 주소 : DD-DD-DD-DD-DD-DD
        - 컴퓨터 5의 MAC 주소 : EE-EE-EE-EE-EE-EE
      - 컴퓨터 1 -> 컴퓨터 3 ; 데이터 전송 => 프레임 비트열 생성 - 목적지 MAC 주소(CC-CC-CC-CC-CC-CC) | 출발지 MAC 주소(AA-AA-AA-AA-AA-AA) | 유형 | 데이터 | 트레일러  -> 전송
        - 목적지 MAC 주소, 출발지 MAC 주소, 유형 이 세 가지를 이더넷 헤더라고 한다.
        - 보내는 측의 컴퓨터 1에서 캡슐화가 일어나고, 캡슐화가 일어난 후, 물리 계층에서 프레임 비트열을 전기 신호로 변환하여 네트워크를 통해 전송한다.
        - 컴퓨터 1에서 보낸 데이터를 허브로 전송하면, 허브와 연결된 모든 포트로 전송한다. 그러면 데이터는 다른 컴퓨터 2 ~ 5로 전송되지만, 목적지 MAC 주소가 자신의 MAC 주소와 다르기 때문에 **데이터를 파기**한다. 
        - 반대로, 컴퓨터 3은 자신의 MAC 주소가 컴퓨터 1이 보낸 데이터의 목적지 MAC 주소와 같으므로 데이터를 수신한다.
        - 즉, 캡슐화가 일어났지만, 역캡슐화도 이루어지는 것이다.
      - 만약, 컴퓨터 1과 컴퓨터 2가 동시에 컴퓨터 3에 데이터를 전송하게 되는 경우, 충돌을 방지하기 위해 CSMA/CD 방식이 사용된다.
        - 여기서 충돌이 감지되면 컴퓨터 2는 잠시 대기하고, 데이터를 다시 전송한다.
  

3. 스위치의 구조
  > 스위치는 허브와 달리 데이터 충돌이 발생하지 않는다.

  - 스위치(Switch) : **데이터 링크 계층**에서 동작하고 **레이어 2 스위치** 또는 **스위칭 허브**라고 불린다. 장비 외형은 허브와 비슷하다. 하지만 기능은 서로 다르다.
  - 스위치 내부에는 **MAC 주소 테이블(MAC Address Table)**이라는 것이 있다. MAC 주소 테이블은 스위치의 **포트 번호**와 해당 포트에 연결되어 있는 컴퓨터의 **MAC 주소**가 등록되는 데이터베이스이다.
    - MAC 주소 테이블을 **브리지 테이블(Bridge Table)**이라고도 한다.

  - 스위치의 전원을 켠 상태에서는 아직 MAC 주소 테이블에 아무것도 등록되어 있지 않다. 하지만 컴퓨터에서 목적지 MAC 주소가 추가된 **프레임**이라는 데이터가 전송되면 MAC 주소 테이블을 확인하고, 출발지 MAC 주소가 등록되어 있지 않으면 MAC 주소를 포트와 함께 등록한다. 이를 **MAC 주소 학습 기능**이라고 한다.

  - MAC 주소 학습 기능 : 데이터 전송 -> 스위치 -> MAC 주소 테이블 -> MAC 주소 테이블에 MAC 주소와 포트가 등록된다.
  - 컴퓨터 1에서 컴퓨터 3에 데이터를 전송한 시점에서는 아직 컴퓨터 3의 목적지 MAC 주소가 MAC 주소 테이블에 등록되어 있지 않아서 송신 포트 이외의 포트에 데이터 프레임이 전송된다. 이러한 데이터(프레임) 전송을 **플러딩(flooding, 홍수)**라고 부른다.

  - 
4. 데이터가 케이블에서 충돌하지 않는 구조

5. 이더넷의 종류와 특징

---
# 네트워크 계층 : 목적지에 데이터 전달하기
1. 네트워크 계층의 역할
2. IP 주소의 구조
3. IP 주소의 클래스 구조
4. 네트워크 주소와 브로드캐스트 주소의 구조
5. 서브넷의 구조
6. 라우터의 구조


-----
# 전송 계층 : 신뢰할 수 있는 데이터 전송하기
1. 전송 계층의 역할
2. TCP의 구조
3. 일련번호와 확인 응답 번호의 구조
4. 포트 번화의 구조
5. UDP의 구조
